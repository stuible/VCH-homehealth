function getLastPart(e){var n=e.split("/");return e.lastIndexOf("/")!==e.length-1?n[n.length-1]:n[n.length-2]}function instantiateSlider(){hideMenu(),clearBackground(),darkBackground(!0);var e=new Swiper(".swiper-container",{direction:"horizontal",loop:!0,slidesPerView:"auto",centeredSlides:!0,mousewheel:!1,hashNavigation:!0,hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".modules-pagination",clickable:!0},keyboard:{enabled:!0,onlyInViewport:!1},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});e.on("slideChange",function(){console.log("current Page: "+currentPage),"modules"==currentPage&&(lastmoduleSlide=$(e.slides[e.activeIndex]).data("hash"))}),vex.dialog.buttons.YES.text="Begin",vex.dialog.buttons.NO.text="Cancel",$(".before-begin-button").click(function(){var t=$(this).data("href");vex.dialog.open({message:"Before You Begin",input:['<div class="vex-custom-field-wrapper">','<label for="date">Label</label>','<div class="vex-custom-input-wrapper">',"Thing","</div>","</div>",'<div class="vex-custom-field-wrapper">','<label for="color">Color</label>','<div class="vex-custom-input-wrapper">',"Thing","</div>","</div>"].join(""),buttons:[$.extend({},vex.dialog.buttons.YES,{text:"Begin",click:function(e,n){return Barba.Dispatcher.trigger("linkClicked",this,n),Barba.Pjax.goTo(t),!1}}),$.extend({},vex.dialog.buttons.NO,{text:"Cancel"})]})})}var introSwiper,moduleSwiper;function instantiateIntro(){console.log("instantiating intro"),showMenu(),darkBackground(!0),introSwiper=new Swiper(".intro-swiper-container",{direction:"vertical",slideClass:"intro-swiper-slide",setWrapperSize:!0,speed:400,hashNavigation:{watchState:!0,replaceState:!0},mousewheel:{invert:!1,sensitivity:1},pagination:{el:".swiper-pagination",clickable:!0}})}function instantiateModule(){console.log("instantiating module"),showMenu(),moduleSwiper=new Swiper(".module-swiper-container",{direction:"vertical",slideClass:"module-swiper-slide",speed:400,mousewheel:{invert:!1},hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".swiper-pagination",clickable:!0}})}function initializeBranching(){console.log("instantiating branching"),setBackground($(".narrative-primary").data("background")),showMenu();var n=0;$(".narrative-answer").click(function(){console.log("ya clicked: "+$(this).attr("href"));var e=$(this).attr("href");return setBackground($('.question-container[data-narrative="'+e+'"]').data("background")),$(".question-container").hide(),$('.question-container[data-narrative="'+e+'"]').show(),1<++n&&$(".narrative-back").show(),!1})}function initializeCaseStudy(){console.log("instantiating case study"),lightBackground(!1),showMenu()}function finalizeCaseStudy(){console.log("finalizing case study");new Waypoint({element:$(".case-study-container"),handler:function(e){console.log(e),"down"==e?darkMenu():lightMenu()},offset:-10})}function instantiateMore(){showMenu()}$().ready(function(){Barba.BaseView.extend({namespace:"modules",onEnter:function(){darkBackground(!0),instantiateSlider(),$(".module-menu").attr("href","#")},onEnterCompleted:function(){clearBackground()}}).init(),Barba.BaseView.extend({namespace:"narrative",onEnter:function(){darkBackground(!0),initializeBranching(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)}}).init(),Barba.BaseView.extend({namespace:"case-study",onEnter:function(){initializeCaseStudy()},onEnterCompleted:function(){finalizeCaseStudy()}}).init(),Barba.BaseView.extend({namespace:"module",onEnter:function(){darkBackground(!0),instantiateModule(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background"))}}).init(),Barba.BaseView.extend({namespace:"more-on-topic",onEnter:function(){instantiateMore(),lightBackground(!0),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)}}).init(),Barba.BaseView.extend({namespace:"introduction",onEnter:function(){instantiateIntro(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background"))}}).init();var e=Barba.BaseTransition.extend({start:function(){Promise.all([this.newContainerLoading,this.fadeOut()]).then(this.fadeIn.bind(this))},fadeOut:function(){return $(this.oldContainer).animate({opacity:0}).promise()},fadeIn:function(){var e=this,n=$(this.newContainer);$(this.oldContainer).hide(),n.css({visibility:"visible",opacity:0}),n.animate({opacity:1},400,function(){e.done()})}});Barba.Pjax.getTransition=function(){return e},Barba.Pjax.start(),Barba.Prefetch.init(),Barba.Pjax.originalPreventCheck=Barba.Pjax.preventCheck,Barba.Pjax.preventCheck=function(e,n){return!!($(n).attr("href")&&-1<$(n).attr("href").indexOf("#"))||Barba.Pjax.originalPreventCheck(e,n)},Barba.Dispatcher.on("linkClicked",function(e){lastElementClicked=e}),Barba.Dispatcher.on("newPageReady",function(e,n,t){var a=getLastPart(e.url.split("#")[0]);console.log("new page is being set to: "+a),"modules"==(currentPage=a)?$(".module-menu").attr("href","#"):$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)})}),$().ready(function(){}),$().ready(function(){var e=$(".narrative"),a=$(".narrative>img"),n={_x:0,_y:0,x:0,y:0,updatePosition:function(e){var n=e||window.event;this.x=n.clientX-this._x,this.y=-1*(n.clientY-this._y)},setOrigin:function(e){this._x=e.offsetLeft+Math.floor(e.offsetWidth/2),this._y=e.offsetTop+Math.floor(e.offsetHeight/2)},show:function(){return"("+this.x+", "+this.y+")"}};n.setOrigin(e);var t=0,i=function(e){n.updatePosition(e),o((n.y/a.offsetHeight/2).toFixed(2),(n.x/a.offsetWidth/2).toFixed(2))},o=function(e,n){var t="rotateX("+e+"deg) rotateY("+n+"deg)";a.style.transform=t,a.style.webkitTransform=t,a.style.mozTranform=t,a.style.msTransform=t,a.style.oTransform=t};e.onmousemove=function(e){t++%10==0&&i(e)},e.onmouseleave=function(){a.style=""},e.onmouseenter=function(e){i(e)}}),$().ready(function(){});var showBackgroundImage=!1;function darkBackground(e){clearBackground(),$("body").animate({backgroundColor:"#161D2B"},"slow"),e?lightMenu():darkMenu()}function lightBackground(e){clearBackground(),$("body").animate({backgroundColor:"#ffffff"},"slow"),e?darkMenu():lightMenu()}function setBackground(e){showBackgroundImage=!0,$(".background").first().fadeOut("slow",function(){$(this).remove().clone().appendTo("body").hide().css({"background-image":"url("+e+")"}).waitForImages(!0).done(function(){showBackgroundImage&&$(this).fadeIn("slow")})})}function clearBackground(){showBackgroundImage=!1,$(".background").stop(!0,!1).fadeOut(),$(".background").not(":last").remove()}function lightMenu(){$(".menubar, .menubar a").animate({color:"#fff"},"fast"),$(".menu-icon").children().children().children().attr("stroke","#fff")}function darkMenu(){$(".menubar, .menubar a").animate({color:"#000"},"z"),$(".menu-icon").children().children().children().attr("stroke","#000")}function hideMenu(){$(".module-menu").fadeOut()}function showMenu(){$(".module-menu").fadeIn()}