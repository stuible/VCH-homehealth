var lastmoduleSlide="",lastmoduleSection="",allRects=null;function instantiateMenu(){setBreadcrumbs($(".barba-container")),$("a.resources").mouseover(function(){$(".resources-dropdown").show()}),$(".menubar").mouseleave(function(){$(".resources-dropdown").hide()})}function lightMenu(){setMenu("light")}function darkMenu(){setMenu("dark")}function setMenu(e){switch(e){case"dark":$(".menubar").removeClass("white"),$(".menubar, .menubar a").stop(!0,!1).animate({color:"#000"},"z"),$(".menu-icon").children().stop(!0,!1).children().children().attr("stroke","#000"),menuIsLight=!1;break;case"light":$(".menubar").removeClass("white"),$(".menubar, .menubar a").stop(!0,!1).animate({color:"#fff"},"fast"),$(".menu-icon").children().children().children().attr("stroke","#fff"),menuIsLight=!0;break;case"white":setMenu("dark"),$(".menubar").addClass("white"),addMenuDropshadowWaypoint()}}function hideMenu(){}function showMenu(){$(".module-menu").fadeIn()}function setBreadcrumbs(e){var t=$(e).data("nav-text"),a=$(e).data("nav-url");$(".menu-name").empty(),jQuery.each(t,function(e){var n="";0==e&&(n=' class="module-menu" '),e==t.length-1?$(".menu-name").append("<a "+n+'href="'+baseurl+a[e]+'">'+this+"</a>"):0==e?$(".menu-name").append("<a "+n+'href="'+baseurl+a[e]+"#"+t[e+1].replace(/\s+/g,"-")+'">'+this+"</a><span> > </span>"):1==e?$(".menu-name").append("<a "+n+'href="'+baseurl+a[e]+"#"+lastmoduleSection+'">'+this+"</a><span> > </span>"):$(".menu-name").append("<a "+n+'href="'+baseurl+a[e]+'">'+this+"</a><span> > </span>")})}function addMenuDropshadowWaypoint(){new Waypoint({element:$(".menubar"),handler:function(e){"down"==e?$(".menubar").addClass("shadow"):$(".menubar").removeClass("shadow")},offset:"-20px"})}function removeMenuDropshadowWaypoint(){$(".menubar").waypoint("destroy")}function drawModulesIcon(){var e,n=Snap(),t=n.rect(18,5,20,20,2),a=n.rect(43,10,10,10,2),i=n.rect(3,10,10,10,2),o=n.rect(-16,10,10,10,2),r=n.group(t,a,i,o);e=menuIsLight?"#fff":"#000",t.attr({fill:"none",stroke:e,strokeWidth:2,"vector-effect":"non-scaling-stroke"}),a.attr({fill:"none",stroke:e,strokeWidth:2,"vector-effect":"non-scaling-stroke"}),i.attr({fill:"none",stroke:e,strokeWidth:2,"vector-effect":"non-scaling-stroke"}),o.attr({fill:"none",stroke:e,strokeWidth:2,"vector-effect":"non-scaling-stroke"});var s=document.getElementsByClassName("menu-icon");$(s).append(n.node),$(".menubar").on("mouseenter",".module-menu",function(e){"modules"!=currentPage&&(r.animate({transform:"translate(20,0)"},700,mina.bounce),t.animate({transform:"s0.5,0.5"},700,mina.bounce),i.animate({transform:"s2,2"},700,mina.bounce))}),$(".menubar").on("mouseleave",".module-menu",function(e){"modules"!=currentPage&&(r.animate({transform:"translate(0,0)"},700,mina.bounce),t.animate({transform:"s1,1"},700,mina.bounce),i.animate({transform:"s1,1"},700,mina.bounce))}),$(".menubar").on("click",".module-menu",function(e){r.animate({transform:"translate(0,0)"},700,mina.bounce),t.animate({transform:"s1,1"},700,mina.bounce),i.animate({transform:"s1,1"},700,mina.bounce),i.animate({opacity:"1"},500),a.animate({opacity:"1"},500)})}function getLastPart(e){var n=e.split("/");return e.lastIndexOf("/")!==e.length-1?n[n.length-1]:n[n.length-2]}$().ready(function(){void 0===Cookies.get(progressCookieName)&&createProgress(),instantiateMenu(),Barba.BaseView.extend({namespace:"modules",onEnter:function(){instantiateSlider(),darkBackground(!0),$(".module-menu").attr("href","#")},onEnterCompleted:function(){}}).init(),Barba.BaseView.extend({namespace:"glossary",onEnter:function(){clearBackground(),instantiateGlossary(),lightBackground(!0)},onEnterCompleted:function(){}}).init(),Barba.BaseView.extend({namespace:"narrative",onEnter:function(){darkBackground(!0),initializeBranching(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)}}).init(),Barba.BaseView.extend({namespace:"case-study",onEnter:function(){clearBackground(),initializeCaseStudy()},onEnterCompleted:function(){finalizeCaseStudy()}}).init(),Barba.BaseView.extend({namespace:"module",onEnter:function(){darkBackground(!0),instantiateModule(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background")),updateMoreOnTopicUI()}}).init(),Barba.BaseView.extend({namespace:"more-on-topic",onEnter:function(){clearBackground(),instantiateMore(),lightBackground(!0),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){updateProgress($(".barba-container").data("module-parent"),"more-on-topic",$(".barba-container").data("name"),!0)}}).init(),Barba.BaseView.extend({namespace:"introduction",onEnter:function(){instantiateIntro(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background")),updateMoreOnTopicUI()}}).init();var e=Barba.BaseTransition.extend({start:function(){Promise.all([this.newContainerLoading,this.fadeOut()]).then(this.fadeIn.bind(this))},fadeOut:function(){return $(this.oldContainer).animate({opacity:0}).promise()},fadeIn:function(){var e=this,n=$(this.newContainer);$(this.oldContainer).hide(),n.css({visibility:"visible",opacity:0}),n.animate({opacity:1},400,function(){e.done()})}});Barba.Pjax.getTransition=function(){return e},Barba.Pjax.start(),Barba.Prefetch.init(),Barba.Pjax.originalPreventCheck=Barba.Pjax.preventCheck,Barba.Pjax.preventCheck=function(e,n){return!!($(n).attr("href")&&-1<$(n).attr("href").indexOf("#"))||Barba.Pjax.originalPreventCheck(e,n)},Barba.Dispatcher.on("linkClicked",function(e){lastElementClicked=e}),Barba.Dispatcher.on("newPageReady",function(e,n,t){var a=getLastPart(e.url.split("#")[0]);introInstantiated=!1,"modules"==(currentPage=a)?$(".module-menu").attr("href","#"):$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide),setBreadcrumbs(t)})});var progressCookieName="module-progress";function getProgress(e,n,t){var a=Cookies.getJSON(progressCookieName);return void 0===n?a[e]:void 0===t?a[e].components[n]:a[e].components[n].element[t].status}function updateProgress(e,n,t,a){var i=Cookies.getJSON(progressCookieName);return i[e].components[n].element[t].status=a,Cookies.set(progressCookieName,i),i}function createProgress(){var e={};pushToProgress(e,[{intro:new element(!1),clinicians:new element(!1),environment:new element(!1),care:new element(!1),deliverables:new element(!1)},{holistic:new element(!1),"older-adult":new element(!1),chronic:new element(!1),"med-management":new element(!1),deliverables:new element(!1)}]),Cookies.set(progressCookieName,e)}function pushToProgress(e,n){for(var t=0;t<modules.length;t++){var a={0:new element(!1),1:new element(!1),2:new element(!1),3:new element(!1),4:new element(!1)};n[t]&&(a=n[t]),e[modules[t]]=new module({objectives:new component({objectives:new element(!1)}),"case-study":new component({margret:new element(!1),franny:new element(!1),luigi:new element(!1),agit:new element(!1)}),"more-on-topic":new component(a)})}}function module(e){this.components=e}function component(e){this.element=e}function element(e){this.status=e}var introSwiper,moduleSwiper,glossary,wordList,introInstantiated=!1;function instantiateSlider(){if(centerLoader(),!0!==introInstantiated){Waypoint.destroyAll();var n=new Swiper(".swiper-container",{direction:"horizontal",loop:!0,slidesPerView:"auto",centeredSlides:!0,updateOnImagesReady:!0,mousewheel:!1,threshold:20,hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".modules-pagination",clickable:!0},keyboard:{enabled:!0,onlyInViewport:!1},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},on:{init:function(){var n=[];$(".module-video").each(function(e){0!=e&&1!=e&&e!=$(".module-video").length-1||this.addEventListener("loadeddata",function(){n.push(this),3==n.length&&($(".swiper-container").addClass("initialized"),$(".modules-pagination").addClass("initialized"),$(".modules-loader").addClass("initialized"))},!1)})}}});showMenu(),darkBackground(!0),setBackground($(n.slides[n.activeIndex]).data("background")),n.on("slideChange",function(){"modules"==currentPage&&(lastmoduleSlide=$(n.slides[n.activeIndex]).data("hash"),setBackground($(n.slides[n.activeIndex]).data("background")))});var t=95,a=!1;n.on("touchStart",function(e){a=!0}),n.on("progress",function(e){a&&(t=e,a=!1),t+7e-4<e&&(t=95,clearBackground())}),n.on("touchEnd",function(e){lastmoduleSlide==$(n.slides[n.activeIndex]).data("hash")&&setBackground($(n.slides[n.activeIndex]).data("background"))}),instantiatePopups(),introInstantiated=!0}}function centerLoader(){var e=$(".faux-slide-wrapper").width();$(".faux-slide-wrapper").css("transform","translate(-"+(e-$(document).width())/2+"px,0)")}function instantiatePopups(){vex.dialog.buttons.YES.text="Begin",vex.dialog.buttons.NO.text="Cancel",$(".before-begin-button").click(function(){var e,t=$(this).data("href"),n=$(this).data("content"),a='<div class="vex-custom-field-wrapper">';for(prereq in n)n[prereq].image&&(e=n[prereq].image),a+='<div class="vex-duration">'+n[prereq].duration+"</div>",a+='<a href="'+n[prereq].link+'" class="vex-title" target="_blank">'+n[prereq].linktext+"</a>",a+='<div class="vex-custom-input-wrapper">',a+='<div class="vex-notes">'+n[prereq].text+"</div>",a+="</div>";a+="</div>",vex.dialog.open({message:"Before I Begin",input:a,buttons:[$.extend({},vex.dialog.buttons.YES,{text:"Begin",click:function(e,n){return Barba.Dispatcher.trigger("linkClicked",this,n),Barba.Pjax.goTo(t),!1}}),$.extend({},vex.dialog.buttons.NO,{text:"Cancel"})]}),$(".vex-content").prepend('<div class="prereq-image" style="background-image: url(\'../'+baseurl+"image/modules/"+e+'\')"></div><div class="prereq-image-placeholder"></div>')})}function instantiateIntro(){showMenu(),Waypoint.destroyAll(),darkBackground(!0),(introSwiper=new Swiper(".intro-swiper-container",{direction:"vertical",slideClass:"intro-swiper-slide",setWrapperSize:!0,init:!1,speed:400,hashNavigation:{watchState:!0,replaceState:!0},mousewheel:{invert:!1,sensitivity:1},pagination:{el:".swiper-pagination",clickable:!0},on:{init:function(){$(".intro-swiper-container").addClass("initialized")}}})).on("slideChange",function(){lastmoduleSection=$(introSwiper.slides[introSwiper.activeIndex]).data("hash")}),introSwiper.on("init",function(){introSwiper.update()}),introSwiper.init()}function instantiateModule(){showMenu(),(moduleSwiper=new Swiper(".module-swiper-container",{direction:"vertical",slideClass:"module-swiper-slide",speed:400,init:!1,mousewheel:{invert:!1},hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".swiper-pagination",clickable:!0},on:{init:function(){$(".module-swiper-container").addClass("initialized")}}})).on("slideChange",function(){lastmoduleSection=$(moduleSwiper.slides[moduleSwiper.activeIndex]).data("hash")}),moduleSwiper.on("init",function(){moduleSwiper.update()}),moduleSwiper.init()}function updateMoreOnTopicUI(){$(".more-on-topic").each(function(){getProgress($(".barba-container").data("module"),"more-on-topic",$(this).data("name"))&&$(this).addClass("done")})}function initializeBranching(){setBackground($(".narrative-primary").data("background"),"high"),showMenu();var n=0;$(".narrative-answer").click(function(){var e=$(this).attr("href");return setBackground($('.question-container[data-narrative="'+e+'"]').data("background"),"high"),$(".question-container").hide(),$('.question-container[data-narrative="'+e+'"]').show(),1<++n&&$(".narrative-back").show(),!1})}function initializeCaseStudy(){Waypoint.destroyAll(),lightBackground(!1),showMenu()}function finalizeCaseStudy(){var n="";new Waypoint({element:$(".case-study-container"),handler:function(e){e!=n&&("down"==e?(n="down",setMenu("white")):(n="up",lightMenu()))},offset:-5});$(".accordion").accordion({animate:200,collapsible:!0,active:!1,icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}})}function instantiateMore(){showMenu(),Waypoint.destroyAll(),instantiateMultipleChoiceQuiz(),instantiateMatchingQuiz(),instantiateVideoGallery()}function instantiateMultipleChoiceQuiz(){var e="You were correct",a="You were partially correct",i="You were wrong";if($(".quiz.feedback").data("feedback")){var n=$(".quiz.feedback").data("feedback");2==n.length?(i=n[0],e=n[1]):3==n.length&&(i=n[0],a=n[1],e=n[2])}$(".quiz.answer").on("click",function(){$(this).children("input").change()}),$(".button-container").on("click",".quiz.button.submit",function(){if($("input[name=multiple-select-quiz]").is(":checked")){var n=[],t=!1;$("input[name=multiple-select-quiz]").each(function(e){$(this).is(":checked")&&1==$(this).data("correct")?t=!0:($(this).is(":checked")||0!=$(this).data("correct"))&&n.push(this)}),0<n.length?t?showQuizScreen(".quiz","incorrect","Partially Correct",a,"again","Try Again"):showQuizScreen(".quiz","incorrect","Wrong",i,"again","Try Again"):showQuizScreen(".quiz","correct","Correct",e,"back","Back")}else vex.dialog.alert("Please chose at least one answer")}),$(".button-container").on("click",".quiz.button.again",function(){hideQuizScreen(".quiz","incorrect","again")}),$(".button-container").on("click",".quiz.button.back",function(){hideQuizScreen(".quiz","correct","back")})}function instantiateMatchingQuiz(){counter=0,$(".matching-answer").draggable({helper:"clone",containment:"frame",revert:!0,start:function(e,n){$(n.helper).children(".seven").remove()},stop:function(e,n){var t=$(n.helper).offset();objName="#clonediv"+counter,$(objName).css({left:t.left,top:t.top}),$(objName).removeClass("drag"),$(objName).draggable({containment:"parent",stop:function(e,n){$(n.helper).offset()}})}}),$(".matching-option").droppable({accept:".matching-answer",drop:function(e,n){var t=$(n.draggable).data("category"),a=$(n.draggable).data("background"),i=$(this).children().first().children().first().children(".matching-circle");if($(this).data("category")==t)$(n.helper).remove(),$(this).addClass("correct"),$(i).css("background-image","url("+a+")"),!0;else{var o=$(i).css("border-color");$(i).animate({"border-color":"red"}).effect("shake",{distance:7,times:3}).animate({"border-color":o}),$(i).css("border-color","")}}})}function showQuizScreen(e,n,t,a,i,o){$(e).children(".response-title").text(t),$(e).children(".response-description").text(a),$(e).children(".quiz.feedback").addClass(n),$(e).children(".quiz.button.submit").removeClass("submit").addClass(i).text(o)}function hideQuizScreen(e,n,t){$(e).children(".quiz.feedback").removeClass(n),$(e).children(".quiz.button."+t).removeClass(t).addClass("submit").text("Submit")}function instantiateVideoGallery(){$(".video.gallery .name").first().addClass("active"),$(".video.gallery iframe").attr("src",$(".video.gallery .name").first().data("video")),$(".video.gallery .name").on("click",function(){$(".video.gallery .name").removeClass("active"),$(this).addClass("active"),$(".video.gallery iframe").attr("src",$(this).data("video"))})}function instantiateGlossary(){glossary=$(".glossary.container").data("glossary"),$.each(glossary,function(e,n){$(".glossary .results>.list").append('<li><div class="term">'+n.term+"</div></li>")}),wordList=new List("search",{valueNames:["term"]}),$(".glossary").on("click",".term",function(){glossaryDefine($(this).text())}),$(".glossary").on("click",".clear",function(){glossaryReset()}),$(".glossary").on("click","input.word",function(){glossaryReset()})}function glossaryReset(){$(".glossary .input input").val(""),glossaryViewMode("terms"),wordList.search()}function glossaryDefine(e){getDefinition(e)&&($(".glossary .input input").val(e),$(".glossary .definition").text(getDefinition(e)),glossaryViewMode("definition"))}function glossaryViewMode(e){"definition"==e?($(".glossary .results").hide(),$(".glossary .definition").show()):"terms"==e&&($(".glossary .results").show(),$(".glossary .definition").hide())}function getDefinition(t){var a=null;return $.each(glossary,function(e,n){n.term==t&&(a=n.definition)}),null!=a&&a}function instantiateResources(){}$().ready(function(){});var showBackgroundImage=!1,menuIsLight=!0;function darkBackground(e){$("body").animate({backgroundColor:"#161616"},"slow"),e?lightMenu():darkMenu()}function lightBackground(e){$("body").animate({backgroundColor:"#ffffff"},"slow"),e&&setMenu("white")}function setBackground(e,n){n=void 0!==n?n:"low";var t=$(".background").first().css("background-image");(t=t.replace('url("',"").replace('")',"").replace(/^.*\/\/[^/]+/,""))!=e&&(showBackgroundImage=!0,$(".background").stop(!0,!1).fadeOut("slow",function(){"low"==n?$(this).remove().clone().appendTo("body").hide().css({"background-image":"url("+e+")",filter:"blur(5px)",opacity:"0.2"}).waitForImages(!0).done(function(){showBackgroundImage&&$(this).fadeIn("slow")}):"high"==n&&$(this).remove().clone().appendTo("body").hide().css({"background-image":"url("+e+")",filter:"blur(0px)",opacity:"0.4"}).waitForImages(!0).done(function(){showBackgroundImage&&$(this).fadeIn("slow")})}))}function clearBackground(){showBackgroundImage=!1,$(".background").stop(!0,!1).fadeOut(function(){$(this).css({"background-image":"unset"})}),$(".background").not(":last").remove()}