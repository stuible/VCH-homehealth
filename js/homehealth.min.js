function getLastPart(e){var n=e.split("/");return e.lastIndexOf("/")!==e.length-1?n[n.length-1]:n[n.length-2]}function setBreadcrumbs(e){console.log($(e).data("nav-text")),console.log($(e).data("nav-url"));var t=$(e).data("nav-text"),a=$(e).data("nav-url");$(".menu-name").empty(),jQuery.each(t,function(e){var n="";0==e&&(n=' class="module-menu" '),e==t.length-1?$(".menu-name").append("<a "+n+'href="'+a[e]+'">'+this+"</a>"):$(".menu-name").append("<a "+n+'href="'+a[e]+'">'+this+"</a><span> > </span>")})}$().ready(function(){void 0===Cookies.get(progressCookieName)&&createProgress(),setBreadcrumbs($(".barba-container")),Barba.BaseView.extend({namespace:"modules",onEnter:function(){instantiateSlider(),darkBackground(!0),$(".module-menu").attr("href","#")},onEnterCompleted:function(){}}).init(),Barba.BaseView.extend({namespace:"narrative",onEnter:function(){darkBackground(!0),initializeBranching(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)}}).init(),Barba.BaseView.extend({namespace:"case-study",onEnter:function(){clearBackground(),initializeCaseStudy()},onEnterCompleted:function(){finalizeCaseStudy()}}).init(),Barba.BaseView.extend({namespace:"module",onEnter:function(){darkBackground(!0),instantiateModule(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background")),updateMoreOnTopicUI()}}).init(),Barba.BaseView.extend({namespace:"more-on-topic",onEnter:function(){clearBackground(),instantiateMore(),lightBackground(!0),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){updateProgress($(".barba-container").data("module-parent"),"more-on-topic",$(".barba-container").data("name"),!0)}}).init(),Barba.BaseView.extend({namespace:"introduction",onEnter:function(){instantiateIntro(),$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide)},onEnterCompleted:function(){setBackground($(".barba-container").data("background"))}}).init();var e=Barba.BaseTransition.extend({start:function(){Promise.all([this.newContainerLoading,this.fadeOut()]).then(this.fadeIn.bind(this))},fadeOut:function(){return $(this.oldContainer).animate({opacity:0}).promise()},fadeIn:function(){var e=this,n=$(this.newContainer);$(this.oldContainer).hide(),n.css({visibility:"visible",opacity:0}),n.animate({opacity:1},400,function(){e.done()})}});Barba.Pjax.getTransition=function(){return e},Barba.Pjax.start(),Barba.Prefetch.init(),Barba.Pjax.originalPreventCheck=Barba.Pjax.preventCheck,Barba.Pjax.preventCheck=function(e,n){return!!($(n).attr("href")&&-1<$(n).attr("href").indexOf("#"))||Barba.Pjax.originalPreventCheck(e,n)},Barba.Dispatcher.on("linkClicked",function(e){lastElementClicked=e}),Barba.Dispatcher.on("newPageReady",function(e,n,t){var a=getLastPart(e.url.split("#")[0]);introInstantiated=!1,console.log("new page is being set to: "+a),"modules"==(currentPage=a)?$(".module-menu").attr("href","#"):$(".module-menu").attr("href",baseurl+"/modules/#"+lastmoduleSlide),setBreadcrumbs(t)})});var progressCookieName="module-progress";function getProgress(e,n,t){var a=Cookies.getJSON(progressCookieName);return void 0===n?a[e]:void 0===t?a[e].components[n]:a[e].components[n].element[t].status}function updateProgress(e,n,t,a){var o=Cookies.getJSON(progressCookieName);return o[e].components[n].element[t].status=a,Cookies.set(progressCookieName,o),o}function createProgress(){for(var e={},n=0;n<modules.length;n++)e[modules[n]]=new module({objectives:new component({objectives:new element(!1)}),"case-study":new component({margret:new element(!1),franny:new element(!1),luigi:new element(!1),agit:new element(!1)}),"more-on-topic":new component({holisticcare:new element(!1),careofanolderadult:new element(!1),chronicconditions:new element(!1),careplanning:new element(!1),"deliverables&quiz":new element(!1)})});Cookies.set(progressCookieName,e)}function module(e){this.components=e}function component(e){this.element=e}function element(e){this.status=e}var introSwiper,moduleSwiper,introInstantiated=!1;function instantiateSlider(){if(!0!==introInstantiated){var n=new Swiper(".swiper-container",{direction:"horizontal",loop:!0,slidesPerView:"auto",centeredSlides:!0,mousewheel:!1,threshold:20,hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".modules-pagination",clickable:!0},keyboard:{enabled:!0,onlyInViewport:!1},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});showMenu(),darkBackground(!0),setBackground($(n.slides[n.activeIndex]).data("background")),n.on("slideChange",function(){console.log("current Page: "+currentPage),"modules"==currentPage&&(lastmoduleSlide=$(n.slides[n.activeIndex]).data("hash"),setBackground($(n.slides[n.activeIndex]).data("background")))});var t=95,a=!1;n.on("touchStart",function(e){a=!0}),n.on("progress",function(e){a&&(t=e,a=!1,console.log("START PROGRESS: "+t)),t+7e-4<e&&(t=95,clearBackground())}),n.on("touchEnd",function(e){lastmoduleSlide==$(n.slides[n.activeIndex]).data("hash")&&setBackground($(n.slides[n.activeIndex]).data("background"))}),instantiatePopups(),introInstantiated=!0}}function instantiatePopups(){vex.dialog.buttons.YES.text="Begin",vex.dialog.buttons.NO.text="Cancel",$(".before-begin-button").click(function(){var t=$(this).data("href"),e=$(this).data("content");console.log(e);var n='<div class="vex-custom-field-wrapper">';for(prereq in e)n+='<div class="vex-duration">'+e[prereq].duration+"</div>",n+='<a href="'+e[prereq].link+'" class="vex-title">'+e[prereq].linktext+"</a>",n+='<div class="vex-custom-input-wrapper">',n+='<div class="vex-notes">'+e[prereq].text+"</div>",n+="</div>";n+="</div>",vex.dialog.open({message:"Before I Begin",input:n,buttons:[$.extend({},vex.dialog.buttons.YES,{text:"Begin",click:function(e,n){return Barba.Dispatcher.trigger("linkClicked",this,n),Barba.Pjax.goTo(t),!1}}),$.extend({},vex.dialog.buttons.NO,{text:"Cancel"})]})})}function instantiateIntro(){console.log("instantiating intro"),showMenu(),darkBackground(!0),introSwiper=new Swiper(".intro-swiper-container",{direction:"vertical",slideClass:"intro-swiper-slide",setWrapperSize:!0,speed:400,hashNavigation:{watchState:!0,replaceState:!0},mousewheel:{invert:!1,sensitivity:1},pagination:{el:".swiper-pagination",clickable:!0}})}function instantiateModule(){console.log("instantiating module"),showMenu(),moduleSwiper=new Swiper(".module-swiper-container",{direction:"vertical",slideClass:"module-swiper-slide",speed:400,mousewheel:{invert:!1},hashNavigation:{watchState:!0,replaceState:!0},pagination:{el:".swiper-pagination",clickable:!0}})}function updateMoreOnTopicUI(){$(".more-on-topic").each(function(){console.log($(this).data("name")+" done: "+getProgress($(".barba-container").data("module"),"more-on-topic",$(this).data("name"))),getProgress($(".barba-container").data("module"),"more-on-topic",$(this).data("name"))&&$(this).children(".narrative-name").css("background-color","blue")})}function initializeBranching(){console.log("instantiating branching"),setBackground($(".narrative-primary").data("background"),"high"),showMenu();var n=0;$(".narrative-answer").click(function(){console.log("ya clicked: "+$(this).attr("href"));var e=$(this).attr("href");return setBackground($('.question-container[data-narrative="'+e+'"]').data("background"),"high"),$(".question-container").hide(),$('.question-container[data-narrative="'+e+'"]').show(),1<++n&&$(".narrative-back").show(),!1})}function initializeCaseStudy(){console.log("instantiating case study"),lightBackground(!1),showMenu()}function finalizeCaseStudy(){console.log("finalizing case study");new Waypoint({element:$(".case-study-container"),handler:function(e){console.log(e),"down"==e?darkMenu():lightMenu()},offset:-10});$(".accordion").accordion({animate:200,collapsible:!0,active:!1,icons:{header:"ui-icon-plus",activeHeader:"ui-icon-minus"}})}function instantiateMore(){showMenu()}$().ready(function(){});var showBackgroundImage=!1,menuIsLight=!0;function darkBackground(e){$("body").animate({backgroundColor:"#161616"},"slow"),e?lightMenu():darkMenu()}function lightBackground(e){$("body").animate({backgroundColor:"#ffffff"},"slow"),e?darkMenu():lightMenu()}function setBackground(e,n){n=void 0!==n?n:"low";var t=$(".background").first().css("background-image");(t=t.replace('url("',"").replace('")',"").replace(/^.*\/\/[^/]+/,""))!=e&&(showBackgroundImage=!0,$(".background").stop(!0,!1).fadeOut("slow",function(){"low"==n?$(this).remove().clone().appendTo("body").hide().css({"background-image":"url("+e+")",filter:"blur(5px)",opacity:"0.2"}).waitForImages(!0).done(function(){showBackgroundImage&&$(this).fadeIn("slow")}):"high"==n&&$(this).remove().clone().appendTo("body").hide().css({"background-image":"url("+e+")",filter:"blur(0px)",opacity:"0.4"}).waitForImages(!0).done(function(){showBackgroundImage&&$(this).fadeIn("slow")})}))}function clearBackground(){showBackgroundImage=!1,$(".background").stop(!0,!1).fadeOut(function(){$(this).css({"background-image":"unset"})}),$(".background").not(":last").remove()}function lightMenu(){$(".menubar, .menubar a").animate({color:"#fff"},"fast"),$(".menu-icon").children().children().children().attr("stroke","#fff"),menuIsLight=!0}function darkMenu(){$(".menubar, .menubar a").animate({color:"#000"},"z"),$(".menu-icon").children().children().children().attr("stroke","#000"),menuIsLight=!1}function hideMenu(){}function showMenu(){$(".module-menu").fadeIn()}